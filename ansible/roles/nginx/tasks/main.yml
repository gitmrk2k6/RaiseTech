# nginxのインストール

- name: Check if nginx is already installed
  command: nginx -v
  register: nginx_version
  changed_when: false
  ignore_errors: true
  become: true

- name: install the latest version of nginx 
  command: amazon-linux-extras install nginx1 -y
  become: true
  when: nginx_version is failed

- name: start nginx service
  service:
    name: nginx
    state: started
  become: true
  when: "'nginx1' not in nginx_version.stdout"

# 自動起動の有効化
- name: enable nginx service
  service:
    name: nginx
    enabled: yes
  become: true

- name: get nginx install version
  command: /usr/sbin/nginx -v
  become: true

- name: get status of nginx service
  command: systemctl status nginx
  become: true
